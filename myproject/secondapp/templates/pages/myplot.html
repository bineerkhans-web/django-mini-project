{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Plots - Stayhome</title>

    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
    <div class="py-1 bg-black top">
        <div class="container">
            <div class="row no-gutters d-flex align-items-start align-items-center px-md-0">
                <div class="col-lg-12 d-block">
                    <div class="row d-flex">
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <div class="icon mr-2 d-flex justify-content-center align-items-center"><span class="icon-phone2"></span></div>
                            {% if user.is_authenticated and user.phone %}
                            <span class="text">{{ user.phone }}</span>
                            {% elif not user.is_authenticated %}
                            <span class="text">+ 1235 2355 98</span>
                            {% endif %}
                        </div>
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <div class="icon mr-2 d-flex justify-content-center align-items-center"><span class="icon-paper-plane"></span></div>
                            {% if user.is_authenticated and user.email %}
                            <span class="text">{{ user.email }}</span>
                            {% elif not user.is_authenticated %}
                            <span class="text">youremail@email.com</span>
                            {% endif %}
                        </div>
                        <div class="col-md-5 pr-4 d-flex topper align-items-center text-lg-right justify-content-end">
                            {% if user.is_authenticated %}
                            <div class="dropdown mb-0 register-link">
                                <a class="dropdown-toggle text-white" href="#" id="myPlotTopUserDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    {{ user.username }}
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="myPlotTopUserDropdown">
                                    <a class="dropdown-item" href="{% url 'myapp:profile' %}">Profile</a>
                                    <a class="dropdown-item" href="{% url 'myapp:signout' %}">Sign Out</a>
                                </div>
                            </div>
                            {% else %}
                            <p class="mb-0 register-link"><a href="{% url 'myapp:signup' %}" class="mr-3">Sign Up</a><a href="{% url 'myapp:signin' %}">Sign In</a></p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light site-navbar-target" id="ftco-navbar">
        <div class="container">
          <a class="navbar-brand" href="{% url 'myapp:home' %}">Stayhome</a>
          <button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="oi oi-menu"></span> Menu
          </button>
  
          <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav nav ml-auto">
              <li class="nav-item"><a href="{% url 'myapp:home' %}#home-section" class="nav-link"><span>Home</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#services-section" class="nav-link"><span>Services</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:properties' %}" class="nav-link"><span>Properties</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#about-section" class="nav-link"><span>About</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#workflow-section" class="nav-link"><span>How it works</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#agent-section" class="nav-link"><span>Agent</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#blog-section" class="nav-link"><span>Blog</span></a></li>
              <li class="nav-item"><a href="{% url 'myapp:home' %}#contact-section" class="nav-link"><span>Contact</span></a></li>
            </ul>
          </div>
        </div>
    </nav>

    <section class="hero-wrap hero-wrap-2" style="background-image: url('{% static 'images/bg_3.jpg' %}');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
          <div class="row no-gutters slider-text align-items-end justify-content-start">
            <div class="col-md-9 ftco-animate pb-4">
              <h1 class="mb-3 bread">My Plots</h1>
               <p class="breadcrumbs"><span class="mr-2"><a href="{% url 'myapp:home' %}">Home <i class="ion-ios-arrow-forward"></i></a></span> <span>My Plots <i class="ion-ios-arrow-forward"></i></span></p>
            </div>
          </div>
        </div>
    </section>

    <section class="ftco-section ftco-properties">
        <div class="container-fluid px-md-5">
            <div class="row">
                <div class="col-lg-12">
                    <div class="row">
                        {% if plots %}
                            {% for plot in plots %}
                                <div class="col-md-6 col-lg-4 mb-4">
                                    <div class="properties ftco-animate">
                                        <div class="img" style="height: 250px; overflow: hidden; position: relative;">
                                            <div class="plot-gallery owl-carousel" data-plot="{{ plot.id }}" style="height: 250px;">
                                                {% with images=plot.images.all %}
                                                    {% if images %}
                                                        {% for image in images %}
                                                            <div class="plot-gallery-item" style="height: 250px;">
                                                                <img src="{{ image.image.url }}" class="img-fluid" alt="{{ plot.title }} image {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover;">
                                                            </div>
                                                        {% endfor %}
                                                    {% else %}
                                                        <div class="plot-gallery-item" style="height: 250px;">
                                                            <img src="{% static 'images/work-1.jpg' %}" class="img-fluid" alt="{{ plot.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                                                        </div>
                                                    {% endif %}
                                                {% endwith %}
                                            </div>
                                        </div>
                                        <div class="desc">
                                            <div class="text bg-primary d-flex text-center align-items-center justify-content-center">
                                                <span>My Plot</span>
                                            </div>
                                            <div class="d-flex pt-5">
                                                <div>
                                                    <h3 class="mb-0">{{ plot.title }}</h3>
                                                    <p class="small text-muted mb-0">{{ plot.location }}</p>
                                                </div>
                                                <div class="pl-md-4 text-right">
                                                    <h4 class="price mb-0">&#8377;{{ plot.price|floatformat:0 }}</h4>
                                                    <small class="text-muted">per cent</small>
                                                </div>
                                            </div>
                                            <p class="h-info"><span class="location">{{ plot.location }}</span> <span class="details">&mdash; {{ plot.cent|floatformat:2 }} cent</span></p>
                                            <p class="mb-2 text-muted small">{{ plot.description|truncatechars:80 }}</p>
                                            <div class="pt-3 d-flex justify-content-between align-items-center">
                                                <a href="{% url 'myapp:property_single' plot.id %}" class="btn btn-outline-primary btn-sm">View</a>
                                                <div>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="modal" data-target="#updatePlotModal{{ plot.id }}">Update</button>
                                                    <button type="button" class="btn btn-outline-danger btn-sm" data-toggle="modal" data-target="#deletePlotModal{{ plot.id }}">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Update Modal -->
                                <div class="modal fade" id="updatePlotModal{{ plot.id }}" tabindex="-1" role="dialog" aria-labelledby="updatePlotModalLabel{{ plot.id }}" aria-hidden="true">
                                  <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="updatePlotModalLabel{{ plot.id }}">Update Plot - {{ plot.title }}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                      <form method="POST" action="{% url 'secondapp:update_plot' plot.id %}">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                          <div class="form-row">
                                            <div class="form-group col-md-6">
                                              <label>Seller Name</label>
                                              <input type="text" name="seller_name" class="form-control" value="{{ plot.seller_name }}" required>
                                            </div>
                                            <div class="form-group col-md-6">
                                              <label>Seller Phone</label>
                                              <input type="text" name="seller_phone" class="form-control" value="{{ plot.seller_phone }}" required>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label>Plot Title</label>
                                            <input type="text" name="title" class="form-control" value="{{ plot.title }}" required>
                                          </div>
                                          <div class="form-row">
                                            <div class="form-group col-md-6">
                                              <label>Location</label>
                                              <input type="text" name="location" class="form-control" value="{{ plot.location }}" required>
                                            </div>
                                            <div class="form-group col-md-3">
                                              <label>Cent</label>
                                              <input type="number" step="0.01" name="cent" class="form-control" value="{{ plot.cent }}" required>
                                            </div>
                                            <div class="form-group col-md-3">
                                              <label>Price per cent</label>
                                              <input type="number" step="0.01" name="price" class="form-control" value="{{ plot.price }}" required>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label>Description</label>
                                            <textarea name="description" class="form-control" rows="4" required>{{ plot.description }}</textarea>
                                          </div>
                                          <p class="text-muted small mb-0">Note: Updating does not change images. To change images, delete and re-upload the plot.</p>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                          <button type="submit" class="btn btn-primary">Save changes</button>
                                        </div>
                                      </form>
                                    </div>
                                  </div>
                                </div>

                                <!-- Delete Modal -->
                                <div class="modal fade" id="deletePlotModal{{ plot.id }}" tabindex="-1" role="dialog" aria-labelledby="deletePlotModalLabel{{ plot.id }}" aria-hidden="true">
                                  <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="deletePlotModalLabel{{ plot.id }}">Delete Plot - {{ plot.title }}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                      <form method="POST" action="{% url 'secondapp:delete_plot' plot.id %}">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                          <p>Are you sure you want to delete this plot? This action cannot be undone.</p>
                                          <p class="mb-0"><strong>{{ plot.title }}</strong></p>
                                          <p class="text-muted mb-0">{{ plot.location }} &mdash; {{ plot.cent|floatformat:2 }} cent</p>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                          <button type="submit" class="btn btn-danger">Delete</button>
                                        </div>
                                      </form>
                                    </div>
                                  </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12 text-center py-5">
                                <h3>You have not uploaded any plots yet.</h3>
                                <p class="text-muted">Upload your first plot to see it listed here.</p>
                                <a href="{% url 'secondapp:upload' %}" class="btn btn-primary mt-3">Upload Plot</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="ftco-footer ftco-section">
      <div class="container-fluid px-md-5">
        <div class="row mb-5">
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Stayhome</h2>
              <p>Far far away, behind the word mountains, far from the countries.</p>
              <ul class="ftco-footer-social list-unstyled mt-5">
                <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4 ml-md-4">
              <h2 class="ftco-heading-2">Community</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Search Properties</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>For Agents</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Reviews</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>FAQs</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4 ml-md-4">
              <h2 class="ftco-heading-2">About Us</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Our Story</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Meet the team</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Careers</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
             <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Company</h2>
              <ul class="list-unstyled">
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>About Us</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Press</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Contact</a></li>
                <li><a href="#"><span class="icon-long-arrow-right mr-2"></span>Careers</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
            \t<h2 class="ftco-heading-2">Have a Questions?</h2>
            \t<div class="block-23 mb-3">
              <ul>
                <li><span class="icon icon-map-marker"></span><span class="text">203 Fake St. Mountain View, San Francisco, California, USA</span></li>
                <li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929 210</span></a></li>
                <li><a href="#"><span class="icon icon-envelope pr-4"></span><span class="text">info@yourdomain.com</span></a></li>
              </ul>
            </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 text-center">
    \n            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->\n  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>\n  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>
        </div>
      </div>
    </footer>

    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
    <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'js/aos.js' %}"></script>
    <script src="{% static 'js/jquery.animateNumber.min.js' %}"></script>
    <script src="{% static 'js/scrollax.min.js' %}"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="{% static 'js/google-map.js' %}"></script>
    
    <script src="{% static 'js/main.js' %}"></script>

    <script>
      (function($) {
        $(document).ready(function() {
          setTimeout(function() {
            $('.plot-gallery').each(function() {
              var $gallery = $(this);
              if ($gallery.hasClass('owl-loaded')) {
                return;
              }
              var itemCount = $gallery.find('.plot-gallery-item').length;
              if (itemCount > 0) {
                $gallery.owlCarousel({
                  items: 1,
                  loop: itemCount > 1,
                  nav: itemCount > 1,
                  dots: itemCount > 1,
                  autoplay: itemCount > 1,
                  autoplayTimeout: 3500,
                  autoplayHoverPause: true,
                  autoHeight: false,
                  navText: [
                    '<span class="ion-ios-arrow-back"></span>',
                    '<span class="ion-ios-arrow-forward"></span>'
                  ]
                });
              }
            });
          }, 300);
        });
      })(jQuery);
    </script>
    
</body>
</html>